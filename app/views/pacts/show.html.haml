= render partial: 'partials/pact_menu'
.content
  .content-section
    .summary-stats
      .summary-stats-stat-container
        .summary-stats-stat
          .summary-stats-stat-label Current Week
          .summary-stats-stat-number #
          .summary-stats-stat-footer
            out of
            = @pact.weeks.count
            weeks total

      .summary-stats-stat-container
        - if @users.count == 0
          = link_to add_users_path, class: "summary-stats-stat summary-stats-stat-empty" do
            .summary-stats-stat-number
              %span.glyphicon.glyphicon-plus.summary-stats-stat-glyphicon
              Add users
        - else
          .summary-stats-stat
            =link_to pact_users_path(@pact), class: "summary-stats-stat-link" do
              .summary-stats-stat-label Users
              .summary-stats-stat-number 
                =@users.count
                users
            .summary-stats-stat-footer
              = link_to "Edit users", add_users_path
      .summary-stats-stat-container
        - if @goals.count == 0 || @users.count == 0
          = link_to add_goals_path, class: "summary-stats-stat summary-stats-stat-empty" do
            .summary-stats-stat-number
              %span.glyphicon.glyphicon-plus.summary-stats-stat-glyphicon
              Add goals
        - else
          .summary-stats-stat
            .summary-stats-stat-label Total Work Outs
            .summary-stats-stat-number 51
            .summary-stats-stat-footer
              %strong 12 
              missed
              &nbsp;&#8226;&nbsp;
              %strong 3 
              bonus
              &nbsp;&#8226;&nbsp;
              = link_to "Edit goals", add_goals_path
      .summary-stats-stat-container
        -if !@pact.penalties.present?
          = link_to add_penalties_path, class: "summary-stats-stat summary-stats-stat-empty" do
            .summary-stats-stat-number
              %span.glyphicon.glyphicon-plus.summary-stats-stat-glyphicon
              Add penalties
        -else
          .summary-stats-stat
            .summary-stats-stat-label Total Penalties In Pot
            .summary-stats-stat-number $X
            .summary-stats-stat-footer
              %strong $X
              paid
              &nbsp;&#8226;&nbsp;
              %strong $X
              pending
              &nbsp;&#8226;&nbsp;
              = link_to "Edit penalties", add_penalties_path

  .content-section
    -if @pact.weeks
      %table
        %thead
          %tr
            %th.border-right{rowspan:2} Week
            %th.border-right{colspan:4} Workouts
            %th{colspan:3} Penalty
          %tr
            %th Goal Days
            %th Workouts
            %th Missed Days
            %th.border-right Bonus Days
            %th Owed
            %th Paid
            %th Total
        %tbody
          -@pact.weeks.each do |week|
            %tr
              %td.border-right
                =link_to pact_week_path(@pact, week) do
                  Week
                  = week.week_number
                %br
                %small
                  = week.start_date.strftime("%b %e")
                  to
                  = week.end_date.strftime("%b %e")
              %td.border-right
              %td
              %td
              %td.border-right
              %td
              %td.border-right
              %td
        %tfoot#upload-chat
          %tr
            %td.border-right 
              Total
              %br
              %small
                = @pact.start_date.strftime("%b %e")
                to
                = @pact.end_date.strftime("%b %e")
            %td
            %td
            %td
            %td.border-right
            %td
            %td
            %td

  .content-box
    %h2 Upload Chat
    = form_tag import_path, multipart: true do
      %label{:for => "file", :class => "pact-upload-label"} Upload Whatsapp .txt file
      = file_field_tag :file, class: "pact-upload-file"
      = submit_tag "Upload Chat", class: "button pact-upload-button"




.content
  %h1= @pact.pact_name
  %table
    %thead
      %tr
        %th Pact ID
        %th Pact Name
        %th Start Date
        %th End Date
        %th Is Active?
      %tr
        %td= @pact.id
        %td= @pact.pact_name
        %td= @pact.start_date
        %td= @pact.end_date
        %td= @pact.is_active

  %h1 Weeks

  %table
    %thead
      %tr
        %th Week ID
        %th Week Number
        %th Week Start Date
        %th Week End Date
        %th Pact ID
      %tbody
        -@pact.weeks.each do |week|
          %tr
            %td= week.id
            %td= week.week_number
            %td= week.start_date
            %td= week.end_date
            %td= week.pact_id



  %h1 Users

  - if @users.present?
    %table
      %thead
        %tr
          %th User ID
          %th First Name
          %th Last Name
          %th Username
      %tbody
        -@users.each do |user|
          %tr
            %td= user.id
            %td= user.first_name
            %td= user.last_name
            %td= user.username
  %p= link_to "Edit users for #{@pact.pact_name}", controller: "pacts", action: "add_users", id: @pact

  %p= link_to "Create Users", new_admin_user_path, :target => '_blank'


  %h1 Penalties


  -if @pact.penalties.present?
    %table
      %thead
        %tr
          %th Goal Days
          %th Penalty
      %tbody
        -@pact.penalties.each do |penalty|
          %tr
            %td= penalty.goal_days
            %td= number_to_currency(penalty.penalty)
    %p= link_to "Edit penalties for #{@pact.pact_name}", controller: "pacts", action: "add_penalties", id: @pact
  -else
    %p 
      Penalties do not exist yet. 
      = link_to "Add Penalty", controller: "pacts", action: "add_penalties", id: @pact


  %h1 Goals

  - if @pact.goals.present?
    %table
      %thead
        %tr
          %th User ID / Username
          %th Pact ID
          %th Goal
          %th Goal ID
          %th Week ID / Week #
      %tbody
        -@pact.goals.each do |pg|
          %tr
            %td
              = pg.user_id
              \/
              = pg.user.username
            %td
              = pg.pact_id
            %td= pg.goal
            %td= pg.id
            %td
              = pg.week_id
              \/
              = pg.week.week_number


  %p= link_to 'Edit Goals', controller: "pacts", action: "add_goals", id: @pact




  %h1 Dashboard


  %table
    %thead
      %tr
        %th User ID
        %th Full Name
        %th Week
        %th Goal Days
        %th Penalty Per Missed Day
        %th Weekly Total Workout
        %th Bonus Days
        %th Total Missed Days at Beginning of Week
        %th Total Missed Days At End of Week
        %th Weekly Penalty Total
        %th Penalty Total At Beginning of Week
        %th Amount Paid
    %tbody
      -@pact.weeks.each do |pw|
        -@pact.users.each do |pu|
          %tr
            %td= pu.id
            %td
              = pu.first_name
              = pu.last_name
              (#{pu.username})
            %td= pw.week_number
            %td
              -if !pu.goals.find_by(week_id: pw.id).nil?
                = pu.goals.find_by(week_id: pw.id).goal
            %td
              -if !@pact.penalties.find_by(goal_days: (pu.goals.find_by(week_id: pw.id))).nil?
                = number_to_currency(@pact.penalties.find_by(goal_days: (pu.goals.find_by(week_id: pw.id).goal) ).goal_days)
            %td
            %td
            %td
            %td
            %td
            %td
            %td


  %h1 Pact's Chat/Messages

  %table
    %thead
      %tr
        %th Message ID
        %th Date+Time
        %th Date
        %th Time
        %th User ID
        %th Sender
        %th Message
        %th Workout?
    %tbody
      - @pact.messages.each do |message|
        %tr
          %td.message-id= message.id
          %td.message-datetime= message.msg_date_time
          %td.message-date= message.date.strftime("%-m/%-d/%Y")
          %td.message-time= message.time
          %td.message-user-id= message.user_id
          %td.message-sender= message.sender
          %td.message-message
            - if message.media == true
              - if message.image != nil
                = image_tag("/media/#{message.image}.jpg", class: "attached-image")
              - elsif message.video != nil
                = video_tag("/media/#{message.video}.mp4", :size => "320x240", :controls => true)
            - else
              = message.message
          %td.message-is-workout
            %p= message.is_workout
            - if message.is_workout == true
              %p= link_to 'Is this a workout?', edit_admin_message_path(message)
            - if @pact.workouts.find_by(message_id: message.id) == nil
              %p Not a workout
            - elsif @pact.workouts.find_by(message_id: message.id).workout_name == nil
              %p= link_to 'Edit workout', edit_admin_workout_path(@pact.workouts.find_by(message_id: message.id))
            - else
              = @pact.workouts.find_by(message_id: message.id).workout_name
              = @pact.workouts.find_by(message_id: message.id).workout_description

